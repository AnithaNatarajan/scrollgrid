!function(a,b){"use strict";if("object"==typeof exports)module.exports=b(require("d3"));else if("function"==typeof define&&define.amd)define(["d3"],function(c){return a.Scrollgrid=b(c),a.Scrollgrid});else if(a.d3)a.Scrollgrid=b(a.d3);else{if(!console||!console.warn)throw"scrollgrid requires d3 to run.  Are you missing a reference to the d3 library?";console.warn("scrollgrid requires d3 to run.  Are you missing a reference to the d3 library?")}}(this,function(a){"use strict";var b=function(b){var c=this.internal,d=c.sizes,e=c.interaction,f=c.render,g=c.dom,h=d.virtual,i=d.physical;b=b||{},b.target?1!==a.select(b.target).length?c.raise('target should be a d3/jquery selector identifying a single div.  E.g. "#tableContainer" where you have a div with id "tableContainer".  Please check that your selector is matching 1 and only 1 div.'):(this.rowHeight=i.rowHeight=b.rowHeight||30,this.dragHandleWidth=i.dragHandleWidth=b.dragHandleWidth||8,this.headerRowHeight=i.headerRowHeight=b.headerRowHeight||i.rowHeight,this.footerRowHeight=i.footerRowHeight=b.footerRowHeight||i.rowHeight,this.defaultColumnWidth=i.defaultColumnWidth=b.defaultColumnWidth||100,this.cellPadding=i.cellPadding=b.cellPadding||6,this.verticalAlignment=i.verticalAlignment=b.verticalAlignment||"top",this.allowColumnResizing=e.allowColumnResizing=b.allowColumnResizing||!0,this.allowSorting=e.allowSorting=b.allowSorting||!0,this.headerRows=h.top=b.headerRows||0,this.footerRows=h.bottom=b.footerRows||0,this.headerColumns=h.left=b.headerColumns||0,this.footerColumns=h.right=b.footerColumns||0,this.target=b.target,f.setDefaultStyles.call(this),this.formatRules=f.formatRules=b.formatRules||[],this.cellWaitText=f.cellWaitText=b.cellWaitText||"loading...",this.sortIconSize=f.sortIconSize=b.sortIconSize||7,g.populateDOM.call(this),this.data(b.data||b.adapter),b.autoResize&&g.setAutoResize.call(this)):c.raise('target is a required field, please provide a selector string for the container. The selector string should be a d3/jquery selector identifying a single div.  E.g. "#tableContainer" where you have a div with id "tableContainer".')};return b.init=function(a,c){c.target=a;var d=new b(c);return d},b.adapters={},b.prototype.internal={sizes:{virtual:{},physical:{}},interaction:{},dom:{},render:{}},b}),Scrollgrid.prototype.internal.dom.getTopMargin=function(a,b){"use strict";var c,d=this.internal,e=d.sizes,f=e.physical,g=0;return a&&a.height&&b&&(c=b.node().offsetHeight,"middle"===f.verticalAlignment?g=(c-a.height)/2:"bottom"===f.verticalAlignment&&(g=c-a.height-1)),g},Scrollgrid.prototype.internal.dom.layoutDOM=function(a){"use strict";var b,c=this,d=c.internal,e=d.dom,f=d.sizes,g=d.render,h=f.physical;e.parent.style("position","relative"),b=e.getTopMargin.call(c,a,e.parent),e.container.style("position","relative").style("width",a&&a.width?a.width+"px":"100%").style("height",a&&a.height?a.height+"px":"100%").style("padding-top",b+"px").style("font-size",0),e.container.node().offsetWidth>e.parent.node().offsetWidth&&e.container.style("width","100%"),e.container.node().offsetHeight>e.parent.node().offsetHeight&&e.container.style("margin-top","0px").style("height","100%"),f.calculatePhysicalBounds.call(c,b),e.setAbsolutePosition.call(c,e.left.svg,0,h.top+b,h.left,h.visibleInnerHeight),e.setRelativePosition.call(c,e.top.svg,h.left,h.visibleInnerWidth,h.top,"hidden"),e.setRelativePosition.call(c,e.main.viewport,h.left,h.visibleInnerWidth,h.visibleInnerHeight,"auto"),e.setAbsolutePosition.call(c,e.right.svg,h.left+h.visibleInnerWidth,h.top+b,h.right,h.visibleInnerHeight),e.setRelativePosition.call(c,e.bottom.svg,h.left,h.visibleInnerWidth,h.bottom,"hidden"),e.setAbsolutePosition.call(c,e.top.left.svg,0,b,h.left+h.dragHandleWidth/2,h.top),e.setAbsolutePosition.call(c,e.top.right.svg,h.left+h.visibleInnerWidth-h.dragHandleWidth/2,b,h.right+h.dragHandleWidth/2,h.top),e.setAbsolutePosition.call(c,e.bottom.left.svg,0,h.top+h.visibleInnerHeight+b,h.left,h.bottom),e.setAbsolutePosition.call(c,e.bottom.right.svg,h.left+h.visibleInnerWidth,h.top+h.visibleInnerHeight+b,h.right,h.bottom),e.setAbsolutePosition.call(c,e.main.svg,h.left,h.top+b,h.visibleInnerWidth,h.visibleInnerHeight),e.top.right.transform.attr("transform","translate("+h.dragHandleWidth/2+", 0)"),e.main.viewport.on("scroll",function(){g.draw.call(c,!1)}),e.setScrollerSize.call(c),h.verticalScrollbarWidth=e.main.viewport.node().offsetWidth-e.main.viewport.node().clientWidth,h.horizontalScrollbarHeight=e.main.viewport.node().offsetHeight-e.main.viewport.node().clientHeight},Scrollgrid.prototype.internal.dom.populateDOM=function(){"use strict";var a=this.internal,b=this.style,c=a.dom;c.parent=d3.select(this.target),c.container=c.parent.append("div"),c.left=c.populatePanel.call(this,b.left.panel),c.top=c.populatePanel.call(this,b.top.panel),c.top.left=c.populatePanel.call(this,b.top.left.panel),c.top.right=c.populatePanel.call(this,b.top.right.panel),c.main=c.populatePanel.call(this,b.main.panel),c.main.viewport=c.container.append("div"),c.right=c.populatePanel.call(this,b.right.panel),c.bottom=c.populatePanel.call(this,b.bottom.panel),c.bottom.left=c.populatePanel.call(this,b.bottom.left.panel),c.bottom.right=c.populatePanel.call(this,b.bottom.right.panel),c.main.scroller=c.main.viewport.append("div")},Scrollgrid.prototype.internal.dom.populatePanel=function(a){"use strict";var b=this.internal.dom,c={};return c.svg=b.container.append("svg"),c.svg.attr("class",a),c.transform=c.svg.append("g"),c.content=c.transform.append("g"),c},Scrollgrid.prototype.internal.dom.setAbsolutePosition=function(a,b,c,d,e){"use strict";return a.style("position","absolute").style("overflow","hidden").style("left",b+"px").style("top",c+"px").style("width",d+"px").style("height",e+"px")},Scrollgrid.prototype.internal.dom.setAutoResize=function(){"use strict";var a=this,b=window.onresize;window.onresize=function(){b&&b(),a.refresh(!0)}},Scrollgrid.prototype.internal.dom.setRelativePosition=function(a,b,c,d,e){"use strict";return a.style("overflow",e).style("position","relative").style("margin-left",b+"px").style("width",c+"px").style("height",d+"px")},Scrollgrid.prototype.internal.dom.setScrollerSize=function(){"use strict";var a=this.internal,b=a.dom,c=a.sizes,d=c.physical;b.main.scroller.style("width",d.totalInnerWidth+"px").style("height",d.totalInnerHeight+"px")},Scrollgrid.prototype.internal.interaction.addResizeHandles=function(a,b,c){"use strict";var d=this,e=d.internal,f=d.style,g=e.sizes,h=e.interaction,i=g.physical,j=c||0;a.content.selectAll(".sg-no-style--handle-selector").remove(),a.content.selectAll(".sg-no-style--handle-selector").data(this.columns.slice(b.left,b.right)).enter().append("rect").attr("class","sg-no-style--handle-selector "+f.resizeHandle).attr("transform","translate("+-1*i.dragHandleWidth/2+", 0)").attr("x",function(a){return j+=a.width,a.x=j,a.x}).attr("y",0).attr("width",i.dragHandleWidth).attr("height",i.top).on("dblclick",function(a){h.autoResizeColumn.call(d,a)}).call(h.getColumnResizer.call(d))},Scrollgrid.prototype.internal.interaction.addSortButtons=function(a,b){"use strict";var c=this,d=c.internal,e=d.interaction;a.append("rect").attr("width",b.boxWidth).attr("height",b.boxHeight).style("opacity",0).style("cursor","pointer").on("click",function(){return e.sortColumn.call(c,b.columnIndex,!0)})},Scrollgrid.prototype.internal.interaction.autoResizeColumn=function(a){"use strict";var b,c=this.internal,d=c.dom,e=c.sizes,f=[d.top.left,d.top,d.top.right,d.left,d.main,d.right,d.bottom.left,d.bottom,d.bottom.right];for(a.width=0,b=0;b<f.length;b+=1)a.width=Math.max(a.width,e.getExistingTextBound.call(this,f[b].svg,a.index).width);this.refresh(!0)},Scrollgrid.prototype.internal.interaction.columnResizeEnd=function(a){"use strict";a.classed("dragging",!1)},Scrollgrid.prototype.internal.interaction.columnResizeStart=function(a){"use strict";d3.event.sourceEvent.stopPropagation(),a.classed("dragging",!0)},Scrollgrid.prototype.internal.interaction.columnResizing=function(a,b){"use strict";b.width-=b.x-d3.event.x,b.x=d3.event.x,b.width<0&&(b.width=0),a.attr("x",b.x),this.refresh(!0)},Scrollgrid.prototype.internal.interaction.defaultComparer=function(a,b){"use strict";var c;return c=isNaN(a)||isNaN(b)?new Date(a)-new Date(b):parseFloat(a)-parseFloat(b),isNaN(c)&&(c=b>a?-1:a>b?1:0),c},Scrollgrid.prototype.internal.interaction.getColumnResizer=function(){"use strict";var a=this.internal,b=a.interaction,c=this;return d3.behavior.drag().origin(function(a){return a}).on("dragstart",function(){b.columnResizeStart.call(c,d3.select(this))}).on("drag",function(a){b.columnResizing.call(c,d3.select(this),a)}).on("dragend",function(){b.columnResizeEnd.call(c,d3.select(this))})},Scrollgrid.prototype.internal.interaction.sortColumn=function(a,b){"use strict";var c,d=this.internal,e=d.interaction,f=d.sizes,g=f.virtual;for(c=0;c<this.columns.length;c+=1)c!==a?delete this.columns[c].sort:b&&(this.columns[c].sort="desc"===this.columns[c].sort?"asc":"desc");this.adapter.sort(a,g.top,g.bottom,"desc"===this.columns[a].sort,this.columns[a].compareFunction||e.defaultComparer),this.refresh(!1)},Scrollgrid.prototype.internal.raise=function(a){"use strict";var b=this.reporter||console;if(!b||!b.error)throw a;b.error(a)},Scrollgrid.prototype.internal.render.applyRules=function(a){"use strict";var b,c,d,e,f,g,h=this.internal,i=h.render,j=h.sizes,k=j.virtual,l={};if(i.formatRules)for(d=0;d<a.length;d+=1){for(l={},f=a[d].rowIndex+1,g=a[d].columnIndex+1,e=0;e<i.formatRules.length;e+=1)if(b=i.formatRules[e],i.matchRule.call(this,b.row,f,k.outerHeight)&&i.matchRule.call(this,b.column,g,k.outerWidth))for(c in b)b.hasOwnProperty(c)&&"row"!==c&&"column"!==c&&(l[c]=b[c]);l.formatter&&(a[d].formatter=l.formatter),l.alignment&&(a[d].alignment=l.alignment),l.cellPadding&&(a[d].cellPadding=l.cellPadding),l.backgroundStyle&&(a[d].backgroundStyle+=" "+l.backgroundStyle),l.foregroundStyle&&(a[d].foregroundStyle+=" "+l.foregroundStyle),l.renderBackground&&(a[d].renderBackground=l.renderBackground),l.renderBetween&&(a[d].renderBetween=l.renderBetween),l.renderForeground&&(a[d].renderForeground=l.renderForeground)}},Scrollgrid.prototype.internal.render.calculateCellAdjustments=function(a,b){"use strict";var c=this.internal,d=c.sizes,e=d.virtual,f=d.physical,g={x:0,y:0,boxHeight:0,boxWidth:0,textHeight:0,textWidth:0};return(a<e.top||a>=e.outerHeight-e.bottom)&&b===e.outerWidth-e.right-1&&(g.boxWidth+=f.verticalScrollbarWidth),(b<e.left||b>=e.outerWidth-e.right)&&a===e.outerHeight-e.bottom-1&&(g.boxHeight+=f.horizontalScrollbarHeight),a===e.top-1&&(g.boxHeight-=1),a===e.top&&a>0&&(g.boxHeight+=1,g.y-=1),b===e.left-1&&(g.boxWidth-=1),b===e.left&&b>0&&(g.boxWidth+=1,g.x-=1),a===e.outerHeight-1&&(g.boxHeight-=1),b===e.outerWidth-1&&(g.boxWidth-=1),a===e.top-1&&(g.sortIcon=this.columns[b]?this.columns[b].sort:void 0),g},Scrollgrid.prototype.internal.render.cropText=function(a,b){"use strict";var c=a.node().getBBox().width,d=a.text(),e=c/d.length,f=Math.ceil(b/e)+1;for(a.datum().originalText=d,0>=f&&a.text("");c>b&&f>=0;)0===f?a.text(""):a.text(d.substring(0,f)),c=a.node().getBBox().width,f-=1},Scrollgrid.prototype.internal.render.draw=function(a){"use strict";var b,c,d=this.internal,e=d.render,f=d.interaction,g=d.sizes,h=d.dom,i=g.virtual,j=g.physical,k=e.getVisibleRegion.call(this),l=e.getDataBounds.call(this,k),m={},n=l.physical,o=l.virtual,p={top:{top:0,bottom:i.top},middle:{top:i.top+o.top,bottom:i.top+o.bottom},bottom:{top:i.outerHeight-i.bottom,bottom:i.outerHeight}},q={left:{left:0,right:i.left},middle:{left:i.left+o.left,right:i.left+o.right},right:{left:i.outerWidth-i.right,right:i.outerWidth}};e.renderRegion.call(this,h.top.left,{},q.left,p.top,a),e.renderRegion.call(this,h.top,{x:n.x},q.middle,p.top,a),e.renderRegion.call(this,h.top.right,{},q.right,p.top,a),e.renderRegion.call(this,h.left,{y:n.y},q.left,p.middle,a),e.renderRegion.call(this,h.main,{x:n.x,y:n.y},q.middle,p.middle,a),e.renderRegion.call(this,h.right,{y:n.y},q.right,p.middle,a),e.renderRegion.call(this,h.bottom.left,{},q.left,p.bottom,a),e.renderRegion.call(this,h.bottom,{x:n.x},q.middle,p.bottom,a),e.renderRegion.call(this,h.bottom.right,{},q.right,p.bottom,a),f.addResizeHandles.call(this,h.top.left,q.left),f.addResizeHandles.call(this,h.top,q.middle,n.x),f.addResizeHandles.call(this,h.top.right,q.right),b=j.left+j.totalInnerWidth+j.right+j.verticalScrollbarWidth,m.width=b<h.parent.node().offsetWidth?b:null,c=j.top+j.totalInnerHeight+j.bottom+j.horizontalScrollbarHeight,m.height=c<h.parent.node().offsetHeight?c:null,h.layoutDOM.call(this,m)},Scrollgrid.prototype.internal.render.getDataBounds=function(a){"use strict";var b,c,d,e,f=this.internal,g=this.columns,h=f.sizes,i=h.virtual,j=h.physical,k=0,l={physical:{x:0,y:0},virtual:{top:Math.max(Math.floor(i.innerHeight*(a.top/j.totalInnerHeight)-1),0),bottom:Math.min(Math.ceil(i.innerHeight*(a.bottom/j.totalInnerHeight)+1),i.innerHeight)}};for(l.physical.y=l.virtual.top*j.rowHeight-a.top,b=0;b<i.innerWidth;b+=1){if(c=g[b+i.left].width,void 0===d&&(b===i.innerWidth-1||k+c>a.left)&&(d=b,l.physical.x=k-a.left),void 0===e&&(b===i.innerWidth-1||k+c>a.right)){e=b+1;break}k+=c}return l.virtual.left=Math.max(Math.floor(d),0),l.virtual.right=Math.min(Math.ceil(e+1),i.innerWidth),l},Scrollgrid.prototype.internal.render.getDataInBounds=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k=this.internal,l=k.sizes,m=k.render,n=l.physical,o=this.columns,p=0,q=[];for(h=a.startY,j=this.adapter.loadDataRange(a),c=a.top||0,b=0;c<a.bottom;c+=1){for(p=n.getRowHeight.call(this,c),g=a.startX||0,d=a.left||0;d<a.right;d+=1,b+=1)i=m.calculateCellAdjustments.call(this,c,d),f=o[d],e=Math.floor(g)+i.x+.5,q[b]={x:e,y:Math.floor(h)+i.y+.5,boxWidth:Math.ceil(f.width)+i.boxWidth,boxHeight:Math.ceil(p)+i.boxHeight,textWidth:Math.ceil(f.width)+i.textWidth,textHeight:Math.ceil(p)+i.textHeight,backgroundStyle:this.style.cellBackgroundPrefix+"r"+(c+1)+" "+this.style.cellBackgroundPrefix+"c"+(d+1),foregroundStyle:this.style.cellForegroundPrefix+"r"+(c+1)+" "+this.style.cellForegroundPrefix+"c"+(d+1),sortIcon:i.sortIcon||"none",cellPadding:n.cellPadding,alignment:"left",rowIndex:c,columnIndex:d,column:f,formatter:null,getValue:j,renderForeground:m.renderForeground,renderBetween:null,renderBackground:m.renderBackground},q[b].key=q[b].columnIndex+"_"+q[b].rowIndex+"_"+q[b].boxHeight+"_"+q[b].boxWidth+"_"+q[b].sortIcon,g+=f.width;h+=p}return m.applyRules.call(this,q),q},Scrollgrid.prototype.internal.render.getTextAnchor=function(a){"use strict";var b="start";return"center"===a.alignment?b="middle":"right"===a.alignment&&(b="end"),b},Scrollgrid.prototype.internal.render.getTextPosition=function(a){"use strict";var b=this.internal,c=b.render,d=0;return"center"===a.alignment?d+=a.textWidth/2:"right"===a.alignment?d+=a.textWidth-a.cellPadding:(d+=a.cellPadding,a.sortIcon&&"none"!==a.sortIcon&&(d+=c.sortIconSize+a.cellPadding)),d},Scrollgrid.prototype.internal.render.getVisibleRegion=function(){"use strict";var a,b=this.internal,c=b.dom;return a={},a.left=c.main.viewport.node().scrollLeft,a.top=c.main.viewport.node().scrollTop,a.right=a.left+c.main.viewport.node().clientWidth,a.bottom=a.top+c.main.viewport.node().clientHeight,a},Scrollgrid.prototype.internal.render.matchRule=function(a,b,c){"use strict";var d,e,f,g,h,i=!1;if(a&&"*"!==a)for(d=a.toString().replace(/\s/g,"").split(","),h=0;h<d.length&&(e=d[h].indexOf(":"),-1!==e?(f=parseFloat(d[h].substring(0,e)),g=parseFloat(d[h].substring(e+1))):(f=parseFloat(d[h]),g=f),f=0>f?c+f+1:f,g=0>g?c+g+1:g,!(i=i||Math.min(f,g)<=b&&Math.max(f,g)>=b));h+=1);else i=!0;return i},Scrollgrid.prototype.internal.render.renderBackground=function(a,b){"use strict";a.append("rect").attr("class",b.backgroundStyle).attr("width",b.boxWidth).attr("height",b.boxHeight)},Scrollgrid.prototype.internal.render.renderForeground=function(a,b){"use strict";var c,d=this,e=d.internal,f=e.render;c=a.append("text").attr("class",b.foregroundStyle).attr("dy","0.35em").attr("x",f.getTextPosition.call(d,b)).attr("y",b.textHeight/2).style("text-anchor",f.getTextAnchor.call(d,b)).text(f.cellWaitText),b.getValue(b.rowIndex,b.columnIndex,function(a){b.formatter?c.text(b.formatter(a)):c.text(a),f.cropText.call(this,c,b.textWidth-b.cellPadding-(b.sortIcon&&"none"!==b.sortIcon?f.sortIconSize+b.cellPadding:0))})},Scrollgrid.prototype.internal.render.renderRegion=function(a,b,c,d,e){"use strict";var f,g,h=this,i=h.internal,j=i.render,k=i.dom,l=i.interaction;(c.left||0)!==(c.right||0)&&(d.top||0)!==(d.bottom||0)&&(g=j.getDataInBounds.call(h,{startX:b.x||0,startY:b.y||0,top:d.top||0,bottom:d.bottom||0,left:c.left||0,right:c.right||0}),e&&a.content.selectAll(".sg-no-style--cell-selector").remove(),f=a.content.selectAll(".sg-no-style--cell-selector").data(g,function(a){return a.key}),f.enter().append("g").attr("class","sg-no-style--cell-selector").each(function(b){var c=d3.select(this);b.renderBackground&&b.renderBackground.call(h,c,b),b.renderBetween&&b.renderBetween.call(h,c,b),b.renderForeground&&b.renderForeground.call(h,c,b),j.renderSortIcon.call(h,b,c,!(!b.sortIcon||"none"===b.sortIcon)),(a===k.top||a===k.top.left||a===k.top.right)&&l.addSortButtons.call(h,c,b)}),f.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),f.exit().remove())},Scrollgrid.prototype.internal.render.renderSortIcon=function(a,b,c){"use strict";var d=this,e=d.internal,f=e.render;c&&a.textWidth>a.cellPadding+f.sortIconSize&&b.append("g").datum(a.sortIcon).attr("class","sg-no-style--sort-icon-selector").attr("transform","translate("+(a.cellPadding+f.sortIconSize/2)+","+a.textHeight/2+")").call(function(a){return f.sortIcon.call(d,a)})},Scrollgrid.prototype.internal.render.setDefaultStyles=function(){"use strict";this.style={left:{panel:"sg-fixed sg-left"},top:{panel:"sg-fixed sg-top",left:{panel:"sg-fixed sg-top-left"},right:{panel:"sg-fixed sg-top-right"}},right:{panel:"sg-fixed sg-right"},bottom:{panel:"sg-fixed sg-bottom",left:{panel:"sg-fixed sg-bottom-left"},right:{panel:"sg-fixed sg-bottom-right"}},main:{panel:"sg-grid"},resizeHandle:"sg-resize-handle",cellBackgroundPrefix:"sg-cell-background-",cellForegroundPrefix:"sg-cell-foreground-",sortIcon:"sg-sort-icon"}},Scrollgrid.prototype.internal.render.sortIcon=function(a){"use strict";var b=this.internal,c=b.render,d=c.sortIconSize,e=a.append("path").attr("class",this.style.sortIcon);"asc"===a.datum()?e.attr("d","M "+d/2+" 0 L "+d+" "+d+" L 0 "+d+" z"):"desc"===a.datum()&&e.attr("d","M 0 0 L "+d+" 0 L "+d/2+" "+d+" z"),e.attr("transform","translate("+e.node().getBBox().width/-2+","+e.node().getBBox().height/-2+")")},Scrollgrid.prototype.internal.sizes.calculatePhysicalBounds=function(a){"use strict";var b,c=this.internal,d=c.sizes,e=d.virtual,f=d.physical;for(f.left=0,b=0;b<e.left;b+=1)f.left+=this.columns[b].width;for(f.totalInnerWidth=0,b=e.left;b<e.outerWidth-e.right;b+=1)f.totalInnerWidth+=this.columns[b].width;for(f.right=0,b=e.outerWidth-e.right;b<e.outerWidth;b+=1)f.right+=this.columns[b].width;f.top=e.top*f.headerRowHeight,f.bottom=e.bottom*f.footerRowHeight,f.visibleInnerWidth=c.dom.container.node().offsetWidth-f.left-f.right,f.visibleInnerHeight=c.dom.container.node().offsetHeight-f.top-f.bottom-a,f.totalInnerHeight=e.innerHeight*f.rowHeight},Scrollgrid.prototype.internal.sizes.calculateTextBound=function(a,b){"use strict";var c,d,e={width:0,height:0};return c=a.append("text").text(b),d=c.node().getBBox(),e.width=d.width,e.height=d.height,c.remove(),e},Scrollgrid.prototype.internal.sizes.getExistingTextBound=function(a,b,c){"use strict";var d=this.internal,e=d.render,f=d.sizes,g={width:0,height:0};return a.selectAll("text").filter(function(a){return!(void 0!==b&&a.columnIndex!==b||void 0!==c&&a.rowIndex!==c)}).each(function(a){var b=a.sortIcon&&"none"!==a.sortIcon?e.sortIconSize+a.cellPadding:0;g=f.pushTextBound(g,d3.select(this),a.cellPadding,b)}),g},Scrollgrid.prototype.internal.sizes.physical.getRowHeight=function(a){"use strict";var b=this.internal,c=b.sizes,d=c.physical,e=c.virtual,f=0;return f=a<e.top?d.headerRowHeight:a<e.outerHeight-e.bottom?d.rowHeight:d.footerRowHeight},Scrollgrid.prototype.internal.sizes.physical.initialiseColumns=function(){"use strict";var a,b,c=this.internal,d=c.render,e=c.sizes,f=e.physical,g=e.virtual;for(this.columns=this.columns||[],a=0;a<g.outerWidth;a+=1)if(this.columns[a]=this.columns[a]||{},this.columns[a].width=this.columns[a].width||f.defaultColumnWidth,d.formatRules&&d.formatRules.length>0)for(b=0;b<d.formatRules.length;b+=1)d.matchRule.call(this,d.formatRules[b].column,a+1,g.outerWidth)&&(this.columns[a]={width:d.formatRules[b].columnWidth||this.columns[a].width,index:a,sort:d.formatRules[b].sort||this.columns[a].sort,compareFunction:d.formatRules[b].compareFunction||this.columns[a].compareFunction})},Scrollgrid.prototype.internal.sizes.pushTextBound=function(a,b,c,d){"use strict";var e,f=b.text();return b.text(b.datum().originalText||b.text()),e=b.node().getBBox(),e.width+2*c+d>a.width&&(a.width=e.width+2*c+d),e.height>a.height&&(a.height=e.height),b.text(f),a},Scrollgrid.adapters.json=function(a,b,c){"use strict";c=c||{};var d,e,f={},g={},h=b||[],i=a,j=c.rowSampleSize||100;if(0===h.length)for(e=0;e<Math.min(i.length,j);e+=1)for(d in i[e])i[e].hasOwnProperty(d)&&void 0===f[d]&&(f[d]=h.length,h.push(d));for(e=0;e<h.length;e+=1)g[h[e]]=h[e];return i.splice(0,0,g),{rowCount:function(){return i.length},columnCount:function(){return h.length},sort:function(a,b,c,d,e){var f,g=i.splice(0,b),j=i.splice(i.length-c);for(i.sort(function(b,c){return e(b[h[a]],c[h[a]])*(d?-1:1)}),f=g.length-1;f>=0;f-=1)i.splice(0,0,g[f]);for(f=0;f<j.length;f+=1)i.push(j[f])},loadDataRange:function(){return function(a,b,c){c(i[a][h[b]]||0)}}}},Scrollgrid.adapters.simple=function(a,b){"use strict";b=b||{};var c,d=0,e=a,f=b.rowSampleSize||100;for(c=0;c<Math.min(e.length,f);c+=1)e[c]&&"[object Array]"===Object.prototype.toString.call(e[c])&&e[c].length>d&&(d=e[c].length);return{rowCount:function(){return e.length},columnCount:function(){return d},sort:function(a,b,c,d,f){var g,h=e.splice(0,b),i=e.splice(e.length-c);for(e.sort(function(b,c){return f(b[a],c[a])*(d?-1:1)}),g=h.length-1;g>=0;g-=1)e.splice(0,0,h[g]);for(g=0;g<i.length;g+=1)e.push(i[g])},loadDataRange:function(){return function(a,b,c){c(e[a][b]||0)}}}},Scrollgrid.prototype.data=function(a){"use strict";var b,c=this.internal,d=c.sizes,e=d.physical,f=d.virtual,g=c.interaction;if(a){for("[object Array]"===Object.prototype.toString.call(a)?this.adapter=Scrollgrid.adapters.simple(a):this.adapter=a,f.outerHeight=this.adapter.rowCount(),f.outerWidth=this.adapter.columnCount(),e.initialiseColumns.call(this),b=0;b<this.columns.length;b+=1)("asc"===this.columns[b].sort||"desc"===this.columns[b].sort)&&g.sortColumn.call(this,b,!1);f.innerWidth=f.outerWidth-f.left-f.right,f.innerHeight=f.outerHeight-f.top-f.bottom,this.refresh(!1)}return this.adapter},Scrollgrid.prototype.refresh=function(a){"use strict";var b=this.internal,c=b.render,d=b.dom;d.layoutDOM.call(this),c.draw.call(this,!a),d.setScrollerSize.call(this)};